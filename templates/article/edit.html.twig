{# This template is a blank page to test some new functionalities -- see HomeController #}

{% extends 'base.html.twig' %}

{% block title %}Test Something{% endblock %}

{% block stylesheets %}{% endblock %}

{% block javascripts %}{% endblock %}

{% block body %}



{# templates/tinymce_image_upload.html.twig #}

{% block content %}
    
    <textarea id="tinymce-editor"></textarea>

    <script src="https://cdn.tiny.cloud/1/ozugcg6rtcsvf9xx1qfujj2aluoo7ezwd2pfx5xnwf4nhujq/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    <script>

        const example_image_upload_handler = (blobInfo, progress) => new Promise((resolve, reject) => {
  const xhr = new XMLHttpRequest();
  xhr.withCredentials = false;
  xhr.open('POST', '{{ path('upload_image') }}');

  xhr.upload.onprogress = (e) => {
    progress(e.loaded / e.total * 100);
  };

  xhr.onload = () => {
    if (xhr.status === 403) {
      reject({ message: 'HTTP Error: ' + xhr.status, remove: true });
      return;
    }

    if (xhr.status < 200 || xhr.status >= 300) {
      reject('HTTP Error: ' + xhr.status);
      return;
    }

    const json = JSON.parse(xhr.responseText);

    if (!json || typeof json.location != 'string') {
      reject('Invalid JSON: ' + xhr.responseText);
      return;
    }

    resolve(json.location);
  };

  xhr.onerror = () => {
    reject('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);
  };

  console.log(blobInfo.blob());
  console.log(blobInfo.filename());

  const formData = new FormData();
  formData.append('file', blobInfo.blob(), blobInfo.filename());

  xhr.send(formData);


});




        tinymce.init({
            selector: "textarea#tinymce-editor",
            plugins: "image",
            toolbar: "insertfile image",
            images_upload_handler: example_image_upload_handler,
            
        });
    </script>

{% endblock %}
    

{% endblock %}