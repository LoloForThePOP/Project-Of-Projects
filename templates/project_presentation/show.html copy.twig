{% extends 'base.html.twig' %}

{% block meta %}

<meta name="author" content="{{ presentation.creator }}">
<meta name="keywords" content="{{ presentation.keywords }}">
<meta name="date" content="{{ presentation.createdAt | date}}">

{% endblock %}

{% block stylesheet %}{% endblock %}

{% block title %}{{ presentation.goal | capitalize}}{% endblock %}

{% block sidebar %} {% include '_partials/sidebar.html.twig' %} {% endblock %}

{% block body %}

<div class="container mt-5">

    {# slideshow #}

    {% include 'project_presentation/_show/slides/slides.html.twig' %}


    <div class="row ">

        {# Presentation Websites #}

        <div class="col-6 py-2 mb-3 border border-success">

            <h4 class="fw-bold mb-2">
                Sites Webs du Projet
            </h4>

            <div id="websites" data-elements-type="websites">

                {% for website in presentation.getOC('websites') %}

                    <div id="{{website.id}}" class="js-sortable-element cursor pointer bg-success mb-2">

                        <a href="{{path("update_other_components_item", {'stringId': stringId, 'component_type': 'websites', 'item_id':website.id})}}" class="w-100 h-100 d-flex align-items-center text-decoration-none">

                            <div class="p-3 text-white">
                                
                                <span class="fw-bold">
                    
                                    {{ website.description }}
                    
                                </span>
                    
                                <br>
                    
                                {{ website.url }}  
                    
                            </div>
                    
                        </a>

                    </div>
                    
                {% endfor %}

            </div>

        </div>

        {# Presentation Needs #}

        <div class="col-6 py-2 mb-3 border border-success">
            
            <h4 class="fw-bold mb-2">
               Besoins du Projet
            </h4>

            <div id="needs" data-elements-type="needs">

                {% for need in presentation.needs %}

                    <div id="{{need.id}}" class="js-sortable-element cursor pointer bg-success mb-2">

                        <a href="{{path("update_other_components_item", {'stringId': stringId, 'component_type': 'needs', 'item_id': need.id})}}" class="w-100 h-100 d-flex align-items-center text-decoration-none">

                            <div class="p-3 text-white">
                                
                                <span class="fw-bold">
                    
                                    {{ need.title }}
                    
                                </span>

                            </div>
                    
                        </a>

                    </div>
                    
                {% endfor %}

            </div>

        </div>

    </div>

    <div class="mb-3">

        <a href="{{path("edit_pp_base", {'stringId': presentation.stringId})}}">
            {% if presentation.logo %}

            <div class="">

                <img src="{{ vich_uploader_asset(presentation) }}" alt="project logo" height="75" width="75">
            </div>

            {% else %}

            <button type="button" class="btn btn-primary">Ajouter logo</button>

            {% endif %}

        </a>
    </div>

    <p class="">

        id: {{presentation.stringId}}

    </p>

    <p class="">

        goal: {{presentation.goal}}

    </p>

    {% if presentation.title %}

    <p class="">

        title: {{presentation.title}}

    </p>

    {% endif %}

    
    <p class="mt-3">

        <a href="{{path("new_pp_conversation", {"stringId": stringId})}}">

            <button>Envoyer un message priv√©</button>

        </a>

       

    </p>

    

    {% if presentation.textDescription %}

    <p class="">
        Text description: {{presentation.textDescription}}
    </p>

    {% endif %}

    {% if presentation.keywords %}

    <p class="">
        keywords: {{presentation.keywords}}
    </p>

    {% endif %}

    {% cache 'pp_show' ~ presentation.updatedAt %}

        <p class="">
            'Yeah'
        </p>

    {% endcache %}
    

    
    <div class="row ">

        {# External Contributors Structures #}

        <div class="col py-2 mb-3 border border-success">

            Sponsors, Partenaires, Remerciements

        </div>

    </div>


</div>

<style>
    p {
        font-size: 1.25em;
        ;
    }
</style>

{% endblock %}



{% block javascripts %}

    <!-- sortable plugin to reorder elements (exemple : reorder presentation slides; reorder presentation websites; etc) -->

    <script src="/js/sortable/sortable.min.js"></script>

    <!-- jQuerySupport for above sortable plugin -->
    
    <script src="/js/sortable/jquery-sortable.js"></script>

    <script>

        // ajax elements reordering & deletion

        $(document).ready(function(){

            // reorder elements capability instantiation

            $('#websites, #needs').sortable({

                animation: 150,

                ghostClass: 'blue-background-class',

                filter: ".disabled",

                onMove: function (evt) {
                    return evt.related.className.indexOf('disabled') === -1;

                },

                // drag and drop implies elements positions updates (ajax call)

                onEnd: function (evt) {

                    var entityType = evt.srcElement.id;

                    

                    // an array storing elements id position

                    var elementsPositions = [];


                    $('#'+entityType+' div.js-sortable-element').each(function(index){
                        
                        elementsPositions.push($(this).attr('id'));
                   
                    });

                    jsonElementsPositions = JSON.stringify(elementsPositions);

                    // setting appropriate route according to entity type (ex: a website; a document; ...)

                    var path = null;

                    switch(entityType) {

                        case "websites":
                        case "dataList":
                        case "questionsAnswers":
                        case "businessCards":

                            path = "{{path('ajax_reorder_items', {'stringId': stringId})}}";
                            break;

                        case "documents":
                        case "needs":
                        case "slides":

                            path = "{{path('ajax_reorder_component_elements', {'stringId': stringId})}}";
                            break;
                            
                        default:

                            break;

                    } 
                    
                    $.ajax({  

                        url: path,
                        type:       'POST',   
                        dataType:   'json',
                        data: {
                            "entityType": entityType,
                            "jsonElementsPosition": jsonElementsPositions,
                        },
    
                        async: true,  
                        
                        success: function(data, status) {
                                 
                        },  
    
                        error : function(xhr, textStatus, errorThrown) {  
                            // alert('Ajax request failed.');  
                        }  
                     }); 

                },
            });

        });

    </script>
                        
{% endblock %}